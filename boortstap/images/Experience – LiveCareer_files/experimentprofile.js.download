window.Profile=window.Profile||{},Profile.isMagenta=false,Profile.profileStorageKey=Profile.isMagenta?"UserPersona":"UserProfile",window.Profile.BaseUrl=window.location.origin,window.Profile.Init=function(e,t,r,i,o,a){i={PremiumStatus:"Not Started",VisitedStages:[],Country:i,Role:r,UserId:e,LayerId:t,Device:o};Profile.isMagenta?"guest"!==r.toLowerCase()?window.Profile.UpdateProfile(i):localStorage.setItem(Profile.profileStorageKey,JSON.stringify(i)):window.Profile.UpdateProfile(i,a)},window.Profile.InitAsync=function(i,o,a,n,l,s){return new Promise((t,r)=>{try{var e={PremiumStatus:"Not Started",VisitedStages:[],Country:n,Role:a,UserId:i,LayerId:o,Device:l};window.Profile.UpdateProfile(e,e=>{t(e),s&&"function"==typeof s&&s()})}catch(e){r(e)}})},window.Profile.ConductExperiment=function(e,t){var r,i,o,a=0,n=setDefaultValues(e),l=JSON.parse(localStorage.getItem(Profile.profileStorageKey));return l&&(n.IsBackend||l.LayerId)&&(r=l&&l.VisitedStages&&0<l.VisitedStages.length?l.VisitedStages.filter(function(e){return e.userStageId==n.StageID&&(""===n.ProductCD||e.productCD==n.ProductCD)}):[],i=!(!n.UseRole||"Guest"==n.UseRole),!n.conductforguestusers||!i)&&(e.ignoreStageCheck||window.Profile.CheckStageEligibility(n.StageID,n.ProductCD))&&(!e.isRCExperiment||!checktrialPurchaseDate(l.TrialPurchaseDate))&&(i=!1,i=n.ExcludedCountry?-1==n.ExcludedCountry.indexOf(l.Country):-1<n.Country.indexOf(l.Country)||n.Country?.toString().toUpperCase().includes("ALL"),n.Device?.toString().toUpperCase().includes(l.Device?.toUpperCase()))&&i&&n.PremiumStatus?.toString().toUpperCase().includes(l.PremiumStatus?.toUpperCase())?(e.updateUserStage&&r&&0<r.length&&(i=l.VisitedStages.indexOf(r[0]),e={userStageId:n.StageID,userStageDateTime:new Date,productCD:n.ProductCD},-1!=i?l.VisitedStages[i]=e:l.VisitedStages.push(e),localStorage.setItem(Profile.profileStorageKey,JSON.stringify(l))),void(n.IsBackend?conductBackendExperiment(l.UserId,n.ExprId,n.culture,n.logTraits,n.includeIterableIntegration,n.skipGoverning,t):window.experiment?(a=window.experiment.conductUserExperiment(l.UserId,l.LayerId,n.ExprId).variant||0,t&&"function"==typeof t&&t(a)):o=setInterval(function(){void 0!==window.experiment&&(clearInterval(o),a=window.experiment.conductUserExperiment(l.UserId,l.LayerId,n.ExprId).variant||0,t)&&"function"==typeof t&&t(a)},50))):a},window.Profile.UpdateUserPremiumStatus=function(e){var t;e&&((t=JSON.parse(localStorage.getItem(Profile.profileStorageKey))).PremiumStatus=e,localStorage.setItem(Profile.profileStorageKey,JSON.stringify(t)))},window.Profile.UpdateStage=function(t,r=""){var e=JSON.parse(localStorage.getItem(Profile.profileStorageKey)),i=e.VisitedStages.filter(function(e){return e.userStageId==t&&(""===r||e.productCD==r)}),o={userStageId:t,userStageDateTime:new Date,productCD:r};0<i.length?(i=e.VisitedStages.indexOf(i[0]),e.VisitedStages[i]=o):e.VisitedStages.push(o),localStorage.setItem(Profile.profileStorageKey,JSON.stringify(e))},window.Profile.UpdateLoginStatus=function(e){var t=JSON.parse(localStorage.getItem(Profile.profileStorageKey));t.Role=e?"User":"Guest",localStorage.setItem(Profile.profileStorageKey,JSON.stringify(t))},window.Profile.UpdateProfile=function(t,r){var e=window.Profile.BaseUrl+(window.Profile.APISlug||"/eb/api")+"/v1/users/experimentprofile";-1<window.location.hostname.indexOf("local")&&window.Profile.localURL&&(e=window.Profile.localURL+"/v1/users/experimentprofile"),Profile.isMagenta?(e=window.globalCompVars.BaseApiUrl+"users/experimentprofile",PS.APIEncryption.callAjax(e,"GET",!1,!0,!0,!0,function(e){e&&(e=JSON.parse(e),t.VisitedStages=e.userStageLogs,t.PremiumStatus=e.premiumStatus,t.TrialPurchaseDate=e.trialPurchaseDate),localStorage.setItem(Profile.profileStorageKey,JSON.stringify(t)),r&&"function"==typeof r&&r()},!1)):callAjaxExpProfile(e,"GET",!1,!0,function(e){e&&(e=JSON.parse(e),t.VisitedStages=e.userStageLogs,t.PremiumStatus=e.premiumStatus,t.TrialPurchaseDate=e.trialPurchaseDate),localStorage.setItem(Profile.profileStorageKey,JSON.stringify(t)),r&&"function"==typeof r&&r()},!1)},window.Profile.UpdateTrialPurchaseDate=function(e){var t=JSON.parse(localStorage.getItem(Profile.profileStorageKey));t.TrialPurchaseDate=e,localStorage.setItem(Profile.profileStorageKey,JSON.stringify(t))},window.Profile.CheckStageEligibility=function(t,r=""){var e,i=!0,o=JSON.parse(localStorage.getItem(Profile.profileStorageKey)).VisitedStages.filter(function(e){return e.userStageId==t&&(""===r||e.productCD==r)});return i=o&&0<o.length&&o[0].userStageDateTime&&(e=new Date,Math.round((e-new Date(o[0].userStageDateTime))/864e5)<14)?!1:i},window.Profile.CheckStgEligibilityAndReturnProfile=function(e,t=""){return{eligibility:window.Profile.CheckStageEligibility(e,t),UserProfile:JSON.parse(localStorage.getItem(Profile.profileStorageKey))}},conductBackendExperiment=function(e,t,r,i=!0,o=!0,a=!0,n){var l=window.Profile.BaseUrl+(window.Profile.APISlug||"/eb/api")+"/v2/users/"+e+"/experiments/"+t+"/conduct";-1<window.location.hostname.indexOf("local")&&window.Profile.localURL&&(l=window.Profile.localURL+"/v2/users/"+e+"/experiments/"+t+"/conduct"),Profile.isMagenta?(l=window.globalCompVars.BaseApiUrlV2+"users/"+e+"/experiments/"+t+"/conduct",PS.APIEncryption.callAjax(l,"POST",!1,!0,!0,!0,n,!1,JSON.stringify(payload))):callAjaxExpProfile(l,"POST",!1,!0,n,!1,JSON.stringify({logTraits:i,conductForOldUsers:!0,includeIterableIntegration:o,culture:r,skipGoverning:a}))},setDefaultValues=function(e){return e.hasOwnProperty("PremiumStatus")||(e.PremiumStatus=["Not Started","Expired"]),e.hasOwnProperty("IsBackend")||(e.IsBackend=!1),e.hasOwnProperty("Country")||(e.Country=["ALL"]),e.hasOwnProperty("Device")||(e.Device="Desktop"),e.hasOwnProperty("culture")||(e.culture="en-US"),e.hasOwnProperty("ignoreStageCheck")||(e.ignoreStageCheck=!1),e},callAjaxExpProfile=function(e,t,r,i,o,a,n){var l=new XMLHttpRequest;l.onload=function(){4==l.readyState&&200==l.status?o&&(a?o(l.responseText,a):o(l.responseText)):4==l.readyState&&500==l.status&&o&&o("")},l.open(t,e,r),i&&(l.withCredentials=!0),n?(l.setRequestHeader("Content-Type","application/json;charset=UTF-8"),l.send(n)):l.send()},checktrialPurchaseDate=function(e){var t,r;return!e||(t=!1,r=new Date,14<Math.round((r-new Date(e))/864e5))||t};